<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Crossword Assistant</title>
  <style>
    :root {
      --bg: #0f1226;
      --card: #151a34;
      --text: #ecf0ff;
      --muted: #a9b0d3;
      --accent: linear-gradient(90deg,#ff005e,#ff8a00,#ffd400,#4cd964,#0fd3ff,#6c4cff,#ff00ff);
      --danger: #ff476f;
      --ok: #21d07a;
      --border: rgba(255,255,255,0.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;display:flex;align-items:center;justify-content:center;
      background:var(--bg);color:var(--text);font-family:sans-serif
    }
    main{
      padding:2rem;max-width:700px;width:95%;
      background:var(--card);border-radius:1rem;box-shadow:var(--shadow);
      display:flex;flex-direction:column;align-items:center
    }
    h1{margin:0 0 .5rem 0;text-align:center}
    .subtitle{color:var(--muted);text-align:center;margin:0 0 1rem 0}

    /* Fancy toggle */
    .toggle-wrapper{
      display:flex;justify-content:center;margin-bottom:1rem;
    }
    .toggle{
      position:relative;width:260px;height:46px;
      background:var(--card);border:1px solid var(--border);
      border-radius:30px;box-shadow:inset 0 2px 5px rgba(0,0,0,.4);
      display:flex;align-items:center;justify-content:space-between;
      overflow:hidden;
    }
    .toggle input{display:none}
    .toggle label{
      flex:1;text-align:center;cursor:pointer;z-index:2;
      font-weight:600;color:var(--muted);user-select:none;
    }
    .toggle input:checked + label{color:#fff}
    .toggle .slider{
      position:absolute;top:3px;bottom:3px;left:3px;
      width:calc(50% - 3px);border-radius:30px;
      background:var(--accent);transition:.3s;
      z-index:1;
    }
    #finder:checked ~ .slider{transform:translateX(100%)}

    input{
      font-size:1.5rem;padding:.5rem;letter-spacing:.2rem;text-transform:uppercase;
      border-radius:.5rem;border:1px solid var(--border);width:100%;text-align:center
    }
    input.valid{border-color:var(--ok);color:var(--ok)}
    input.invalid{border-color:var(--danger);color:var(--danger)}
    .hint{margin:.5rem 0 0 0;color:var(--muted);font-size:.9rem;text-align:center}
    button{
      padding:.75rem 1.5rem;margin-top:1rem;font-size:1rem;border:none;border-radius:.5rem;
      background:var(--accent);color:#fff;cursor:pointer
    }
    button:disabled{opacity:.4;cursor:not-allowed}
    .results{
      margin-top:1.5rem;width:100%;max-height:320px;overflow-y:auto;
      background:var(--card);border:1px solid var(--border);border-radius:.5rem;padding:1rem
    }
    .resultsHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
    ul{list-style:none;padding:0;margin:0}
    li{padding:.25rem 0;border-bottom:1px solid var(--border)}
    .chips{display:flex;flex-wrap:wrap;justify-content:center;margin:.6rem 0}
    .chip{
      width:2rem;height:2rem;margin:.15rem;border-radius:.25rem;background:var(--border);
      display:flex;align-items:center;justify-content:center;font-weight:bold
    }
    .chip.letter{background:var(--ok);color:#fff}
    .chip.wild{background:var(--danger);color:#fff}
  </style>
</head>
<body>
  <main>
    <h1>Crossword Assistant</h1>
    <p class="subtitle">Switch between modes to solve anagrams or find words with missing letters.</p>

    <!-- Fancy toggle -->
    <div class="toggle-wrapper">
      <div class="toggle">
        <input type="radio" name="mode" id="anagram" value="anagram" checked>
        <label for="anagram">Anagram</label>
        <input type="radio" name="mode" id="finder" value="finder">
        <label for="finder">Word Finder</label>
        <div class="slider"></div>
      </div>
    </div>

    <input
      id="letters" type="text" maxlength="15"
      placeholder="Enter letters..."
      aria-label="Input"
      autocomplete="off" autocapitalize="characters" spellcheck="false"
    >
    <div class="chips" id="chips"></div>
    <p id="hint" class="hint"></p>

    <button id="solve" disabled>Solve</button>

    <div class="results" id="results" aria-live="polite">
      <div class="resultsHeader"><strong>Results</strong> <span id="count">0</span></div>
      <ul id="list"></ul>
    </div>
  </main>

  <!-- Dictionaries -->
  <script src="dictionarymap.js"></script>
  <script src="dictionarylist.js"></script>

  <script>
    (function(){
      const input = document.getElementById('letters');
      const button = document.getElementById('solve');
      const list = document.getElementById('list');
      const count = document.getElementById('count');
      const chips = document.getElementById('chips');
      const results = document.getElementById('results');
      const modeRadios = document.querySelectorAll('input[name="mode"]');
      const hint = document.getElementById('hint');

      function getMode(){
        return document.querySelector('input[name="mode"]:checked').value;
      }

      function clearResults(){
        list.innerHTML = '';
        count.textContent = '0';
      }

      function renderChips(value, mode){
        chips.innerHTML = '';
        for(let i=0;i<value.length;i++){
          const c = document.createElement('div');
          if(mode==='finder'){
            if(value[i] === '?'){ c.className='chip wild'; c.textContent='?'; }
            else { c.className='chip letter'; c.textContent=value[i]; }
          }else{
            c.className='chip letter';
            c.textContent=value[i];
          }
          chips.appendChild(c);
        }
      }

      function sanitizeAnagram(str){
        const letters = (str.match(/[a-z]/gi) || []).join('').toUpperCase();
        return letters.slice(0, 15);
      }

      function sanitizeFinder(str){
        const up = str.toUpperCase();
        let out = '';
        for(const ch of up){
          if(/[A-Z]/.test(ch)) out += ch;
          else if(ch === ' ' || ch === '?') out += '?';
          else continue;
          if(out.length >= 15) break;
        }
        return out;
      }

      function updateHint(){
        const mode = getMode();
        hint.textContent =
          (mode === 'anagram')
            ? 'Anagram: enter 3–15 letters. Solve enables at 3+ letters.'
            : 'Word Finder: ENTER LETTERS, or SPACE for wildcard “?”. Solve enables once a wildcard is present.';
      }

      function setValidityAndButton(){
        const mode = getMode();
        const val = input.value;
        let valid = false;

        if(mode === 'anagram'){
          valid = (val.length >= 3);
        } else {
          valid = (val.includes('?')); // no minimum letters, just at least one wildcard
        }

        input.classList.toggle('valid', valid);
        input.classList.toggle('invalid', !valid && val.length > 0);
        button.disabled = !valid;
      }

      function updateUI(){
        const mode = getMode();
        renderChips(input.value, mode);
        setValidityAndButton();
      }

      function signature(str){
        return str.split('').sort().join('');
      }

      function renderResults(words){
        list.innerHTML = '';
        if(!words || words.length === 0){
          count.textContent = '0';
          const li = document.createElement('li');
          li.textContent = 'No matches found';
          list.appendChild(li);
          return;
        }
        const uniq = Array.from(new Set(words)).sort((a,b)=>a.localeCompare(b));
        count.textContent = String(uniq.length);
        for(const w of uniq){
          const li = document.createElement('li');
          li.textContent = w;
          list.appendChild(li);
        }
      }

      input.addEventListener('input', ()=>{
        const mode = getMode();
        const cleaned = (mode==='anagram') ? sanitizeAnagram(input.value) : sanitizeFinder(input.value);
        if(cleaned !== input.value) input.value = cleaned;
        updateUI();
      });

      input.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' && !button.disabled){
          e.preventDefault();
          button.click();
        }
      });

      button.addEventListener('click', ()=>{
        if(button.disabled) return;
        results.setAttribute('aria-busy','true');
        const mode = getMode();
        const val = input.value;

        if(mode === 'anagram'){
          const sig = signature(val);
          const matches = (window.DICTIONARYMAP && window.DICTIONARYMAP[sig]) ? window.DICTIONARYMAP[sig] : [];
          renderResults(matches);
        } else {
          const regex = new RegExp('^' + val.replace(/\?/g, '.') + '$', 'i');
          const words = Array.isArray(window.DICTIONARY) ? window.DICTIONARY : [];
          const matches = words.filter(w => regex.test(w));
          renderResults(matches);
        }

        results.setAttribute('aria-busy','false');
        setValidityAndButton();
      });

      modeRadios.forEach(radio=>{
        radio.addEventListener('change', ()=>{
          input.value = '';
          clearResults();
          updateHint();
          updateUI();
        });
      });

      // init
      updateHint();
      input.value = '';
      updateUI();
    })();
  </script>
</body>
</html>

